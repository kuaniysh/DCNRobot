*** Settings ***
Suite Setup       Init_Test_Case
Suite Teardown    Uninit_Test_Case
Test Setup
Force Tags        all    6222
Resource          ap_configuration_vars.txt
Resource          ap_configuration_modifiable.txt

*** Test Cases ***
2.2.2.1-2管理Ac按Mac独立升级Ap
    [Documentation]    2.2.2.1	管理AC上可以wireless ap download start <ap1_mac>触发手动独立升级ap1 image,ap1重启后被AC管理，image版本已经更新成功。
    ...    2.2.2.2	管理AC上可以wireless ap download start <ap1_mac>触发手动独立升级ap1 image,ap2不会被触发。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ${WIFI_AFFIRM_AP1_MAC}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ${WIFI_AFFIRM_AP1_MAC}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}

2.2.2.3-4管理Ac按ImageType手动独立升级并且其他image不受影响
    [Documentation]    2.2.2.3	管理AC上可以wireless ap download start imagetype x触发手动独立升级imagetype x的所有ap，ap重启后被AC管理，image版本已经更新成功。
    ...    2.2.2.4	管理AC上可以wireless ap download start imagetype x触发手动独立升级imagetype x的所有ap，其它 imagetype的ap不会被触发。
    AC.Exec Cmd List In WirelessMode    ${ac1}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start imagetype ${ap1_image_type}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start imagetype ${ap1_image_type}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}

2.2.2.7-8管理Ac上可以同时升级全部Ap
    [Documentation]    2.2.2.7	管理AC上可以wireless ap download start 触发手动独立升级所有ap，ap重启后被AC管理，image版本已经更新成功。
    ...    2.2.2.8	管理AC上可以wireless ap download start 触发手动独立升级所有ap，ap已经下载完image，无法使用wireless ap download abort命令终止AP Image更新进程。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    60
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}

2.2.2.5管理Ac可以按Ap组(Name)触发升级
    [Documentation]    2.2.5.1	管理AC上可以wireless ap download start ap-group <word>触发手动独立升级此ap-group(以ap-name分组)的所有ap，ap重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    ap-group 111    permit-ap-name ${WIFI_AFFIRM_AP1_MAC}    exit
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ap-group 111
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ap-group 111
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd    ${ac1}    no ap-group 111

2.2.2.6管理Ac可以按Ap组(Ip)触发升级
    [Documentation]    2.2.5.2	管理AC上可以wireless ap download start ap-group <word>触发手动独立升级此ap-group(以ip地址段分组)的所有ap，ap重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    ap-group 111    permit-ap-network ${ap1_ip} 255.255.255.0    exit
    AC.Exec Cmd List In WirelessMode    ${ac1}    ap-group 111    permit-ap-network ${ap2_ip} 255.255.255.0    exit
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ap-group 111
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ap-group 111
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd    ${ac1}    no ap-group 111

2.2.2.20-21手动升级配置错误文件不能正常升级
    [Documentation]    2.2.2.20	手动独立升级，配置的ap image文件错误（其它image-type的文件），ap从服务器下载完image后不重启，ac上show wireless ap download显示Download Status为Failure
    ...    2.2.2.21	（接上）重新配置正确的ap image文件，可以重新触发手动独立升级，ap版本升级成功
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ${WIFI_AFFIRM_AP1_MAC}
    sleep    60
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Failure
    Should Be True    ${return}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ${WIFI_AFFIRM_AP1_MAC}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start ${WIFI_AFFIRM_AP1_MAC}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}

2.2.2.9-10手动独立升级下载过程中可取消
    [Documentation]    2.2.2.9 管理AC上可以wireless ap download start 触发手动独立升级所有ap，ap正在下载image，show wireless ap download显示ap状态为Code Transfer In Progress，可以使用wireless ap download abort命令终止AP Image更新进程。show wireless ap download显示Download Status为Aborted。
    ...
    ...    2.2.2.10 （接上）show wireless ap download显示Download Status为Aborted的时候，管理AC上可以wireless ap download start 重新触发手动独立升级所有ap，ap重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    AC.Get Debug Output Until Expect    ${ap1}    ETA
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    sleep    1
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    sleep    1
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    sleep    1
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Aborted
    Should Be True    ${return}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    sleep    60
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}

2.2.2.11分组独立升级状态测试1
    [Documentation]    2.2.2.11 分组手动独立升级AP image：管理AC上可以wireless ap download start 触发手动独立升级所有ap，第一组ap先下载Image，show wireless ap download显示前x个ap状态处于Code Transfer In Progress，其它等待ap状态处于Requested（使用wireless ap download group-size x配置每组同时下载Image的 AP数目小于目前管理AP数）
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 1
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    5
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Code Transfer
    Should Be True    ${return}
    ${return}=    Tools.Is Match From String    ${output}    Requested
    Should Be True    ${return}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 10

2.2.2.12分组独立升级状态测试2
    [Documentation]    2.2.2.12 分组手动独立升级AP image：管理AC上可以wireless ap download start 触发手动独立升级所有ap，下载完Image的ap状态处于Waiting For APs To Dow，正在下载的ap状态处于Code Transfer In Progress，其它等待ap状态处于Requested
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 1
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    AC.Get Debug Output Until Expect    ${ap1}    watchdog
    sleep    5
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Code Transfer
    Should Be True    ${return}
    ${return}=    Tools.Is Match From String    ${output}    Waiting For
    Should Be True    ${return}
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 10

2.2.2.13分组独立升级状态测试3
    [Documentation]    2.2.2.13	分组手动独立升级AP image：管理AC上可以wireless ap download start 触发手动独立升级所有ap，ap全部下载完Image后状态都为NVRAM Update In Progress，ap全部重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 1
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    180
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    NVRAM
    Should Be True    ${return}
    sleep    ${300}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 10

2.2.2.14分组独立升级Abort测试1
    [Documentation]    2.2.2.14 分组手动独立升级AP image的时候，ap处于Code Transfer In Progress和Requested，管理AC上可以使用wireless ap download abort命令终止AP Image更新进程，之后管理AC上可以wireless ap download start 重新触发手动独立升级所有ap，ap重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 1
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    1
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Aborted
    Should Be True    ${return}
    sleep    60
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 10

2.2.2.15分组独立升级Abort测试2
    [Documentation]    2.2.2.15 分组手动独立升级AP image的时候，ap处于Waiting For APs To Dow和Code Transfer In Progress，管理AC上可以使用wireless ap download abort命令终止AP Image更新进程，之后管理AC上可以wireless ap download start 重新触发手动独立升级所有ap，ap重启后被AC管理，image版本已经更新成功。
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_old_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 1
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    AC.Get Debug Output Until Expect    ${ap1}    watchdog
    AC.Exec Cmd    ${ac1}    wireless ap download abort
    AC.Enable Mode    ${ac1}
    ${output}=    AC.Exec Cmd    ${ac1}    show wireless ap download
    ${return}=    Tools.Is Match From String    ${output}    Aborted
    Should Be True    ${return}
    sleep    60
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_old_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_old_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap1_image_type} ${ap1_now_image_string}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download image-type ${ap2_image_type} ${ap2_now_image_string}
    AC.Enable Mode    ${ac1}
    AC.Exec Cmd    ${ac1}    wireless ap download start
    sleep    ${ap_upgrade_time}
    AP.Enable Mode    ${ap1}
    Telnet.Switch Connection    ${ap1}
    ${output}=    AP.Exec Cmd    ${ap1}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap1_now_version_string}
    Should Be True    ${return}
    AP.Enable Mode    ${ap2}
    Telnet.Switch Connection    ${ap2}
    ${output}=    AP.Exec Cmd    ${ap2}    get system
    ${return}=    Tools.Is Match From String    ${output}    (?im)^version\\s+${ap2_now_version_string}
    Should Be True    ${return}
    AC.Exec Cmd List In WirelessMode    ${ac1}    wireless ap download group-size 10
