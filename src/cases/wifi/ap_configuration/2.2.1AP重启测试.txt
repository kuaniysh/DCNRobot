*** Settings ***
Suite Setup       Init_Test_Case
Suite Teardown    Uninit_Test_Case
Test Setup
Resource          ap_configuration_vars.txt
Resource          ap_configuration_modifiable.txt

*** Test Cases ***
2.2.1.1管理AC上可以指定ap1重启
    [Documentation]    2.2.1.1	管理AC上可以wireless ap reset <ap1_mac>重启指定ap1，ap1重启后重新上线，被AC管理。
    [Tags]    all    6222
    AC.Enable Mode    ${ac1}
    Reset_Ap_From_Ac    ${ac1}    ${ap1}    ${WIFI_AFFIRM_AP1_MAC}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP1_MAC}
    sleep    ${profile_apply_time}

2.2.1.2手动重启AP不影响其他AP
    [Documentation]    2.2.1.2	管理AC上可以wireless ap reset <ap1_mac>重启指定ap1，其它ap不会重启。
    [Tags]    all    6222
    AP.Enable Mode    ${ap2}
    AP.Exec Cmd List    ${ap2}    admin    admin
    AC.Enable Mode    ${ac1}
    Reset_Ap_From_Ac    ${ac1}    ${ap1}    ${WIFI_AFFIRM_AP1_MAC}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP1_MAC}
    AP.Enable Mode    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Not Be True    ${return}
    sleep    ${profile_apply_time}

2.2.1.3AC上重启所有自己管理AP
    [Documentation]    2.2.1.3	管理AC上可以wireless ap reset重启所有自己管理ap，ap重启后重新上线，被AC管理。
    [Tags]    all    6222
    AP.Enable Mode    ${ap1}
    Telnet.Read
    AP.Enable Mode    ${ap2}
    Telnet.Read
    AC.Enable Mode    ${ac1}
    Telnet.Write    wireless ap reset
    Telnet.Read Until Regexp    Y/N
    Telnet.Write    y
    sleep    ${ap_reset_time}
    Telnet.Switch Connection    ${ap1}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    Telnet.Switch Connection    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    AP.Enable Mode    ${ap1}
    AP.Enable Mode    ${ap2}

2.2.1.4非controler管理AC上可以重启自己所有ap
    [Documentation]    2.2.1.4	管理AC上可以wireless ap reset重启所有自己管理ap，peer管理的ap不会重启（AC不是Controller）。
    [Tags]    all    6222
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac2_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac2}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    ${profile_apply_time}
    AP.Enable Mode    ${ap1}
    Telnet.Read
    AP.Enable Mode    ${ap2}
    Telnet.Read
    AC.Enable Mode    ${ac2}
    Telnet.Write    wireless ap reset
    Telnet.Read Until Regexp    Y/N
    Telnet.Write    y
    sleep    ${ap_reset_time}
    Telnet.Switch Connection    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    Telnet.Switch Connection    ${ap1}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Not Be True    ${return}
    AP.Enable Mode    ${ap1}
    AP.Enable Mode    ${ap2}
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac1_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}

2.2.1.5Controler上可以指定peer上ap重启
    [Documentation]    2.2.1.5	Controller上可以wireless ap reset <ap1_mac>重启指定peer上ap1，ap1重启后重新上线，被AC管理。
    [Tags]    all    6222
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac2_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac2}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    ${profile_apply_time}
    AC.Enable Mode    ${ac1}
    Reset_Ap_From_Ac    ${ac1}    ${ap2}    ${WIFI_AFFIRM_AP2_MAC}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac1_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    20s

2.2.1.6Controller上可以重启自己管理的AP2
    [Documentation]    2.2.1.6	Controller上可以wireless ap reset <ap2_mac>重启指定自己管理的ap2，ap2重启后重新上线，被AC管理。
    [Tags]    all    6222
    AC.Enable Mode    ${ac1}
    Reset_Ap_From_Ac    ${ac1}    ${ap2}    ${WIFI_AFFIRM_AP2_MAC}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    ${profile_apply_time}

2.2.1.7Controller重启指定ap1其他不重启
    [Documentation]    2.2.1.7	Controller上可以wireless ap reset <ap1_mac>重启指定ap1，其它ap不会重启。
    [Tags]    all    6222
    AC.Enable Mode    ${ac1}
    Reset_Ap_From_Ac    ${ac1}    ${ap1}    ${WIFI_AFFIRM_AP1_MAC}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP1_MAC}
    AP.Enable Mode    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Not Be True    ${return}
    sleep    ${profile_apply_time}

2.2.1.8Controller上可以重启所有Ap，Peer上ap重新上线
    [Documentation]    2.2.1.8	Controller上可以wireless ap reset重启所有ap，peer上ap重启后重新上线，被AC管理。
    [Tags]    all    6222
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac2_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac2}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    ${profile_apply_time}
    Show_Wireless_Ap_Status    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}
    Telnet.Write    wireless ap reset
    Telnet.Read Until Regexp    Y/N
    Telnet.Write    y
    sleep    ${ap_reset_time}
    Telnet.Switch Connection    ${ap1}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    Telnet.Switch Connection    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    AP.Enable Mode    ${ap1}
    AP.Enable Mode    ${ap2}
    AP.Exec Cmd    ${ap2}    set managed-ap switch-address-1 ${ac1_ip}
    AP.Save Running    ${ap2}
    AP.Reboot AP    ${ap2}
    AC.Wait For AP Profile Apply OK    ${ac1}    ${WIFI_AFFIRM_AP2_MAC}
    sleep    ${profile_apply_time}

2.2.1.9Controller上重启所有ap，自己Ap可重新上线
    [Documentation]    2.2.1.9	Controller上可以wireless ap reset重启所有ap，自己管理ap重启后重新上线，被AC管理。
    [Tags]    all    6222
    AP.Enable Mode    ${ap1}
    Telnet.Read
    AP.Enable Mode    ${ap2}
    Telnet.Read
    AC.Enable Mode    ${ac1}
    Telnet.Write    wireless ap reset
    Telnet.Read Until Regexp    Y/N
    Telnet.Write    y
    sleep    ${ap_reset_time}
    Telnet.Switch Connection    ${ap1}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    Telnet.Switch Connection    ${ap2}
    ${output}=    Telnet.Read
    ${return}=    Tools.Is Match From String    ${output}    Starting mapd
    Should Be True    ${return}
    AP.Enable Mode    ${ap1}
    AP.Enable Mode    ${ap2}
    sleep    ${profile_apply_time}
